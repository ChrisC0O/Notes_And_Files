# Instalation of Wikimedia

## !NOTE!
Goto [wikimedia](https://www.mediawiki.org/wiki/MediaWiki) And read the instalation file
Use the Web based setup first, then when done edit the LocalSettings.php


#### LocalSettings.php
This is the config file for the site.
Use snipits from this to configure stuff like:
- Locking down the site for none Auth users
- Enable uploading off all files.


## File Header & Security

```php
<?php
# This file was automatically generated by the MediaWiki 1.44.2
# installer. If you make manual changes, please keep track in case you
# need to recreate them later.
#
# See includes/MainConfigSchema.php for all configurable settings
# and their default values, but don't forget to make changes in _this_
# file, not there.
#
# Further documentation for configuration settings may be found at:
# https://www.mediawiki.org/wiki/Manual:Configuration_settings
```

> **Purpose**: Informational header. Do not edit unless you know what you're doing.

```php
# Protect against web entry
if ( !defined( 'MEDIAWIKI' ) ) {
    exit;
}
```

> **Security**: Prevents direct access to this file via URL. Only allows inclusion by MediaWiki core.

---

## Uploads & File Handling

```php
$wgEnableUploads = true;
```

> **Enables file uploads** (images, PDFs, etc.) via Special:Upload.

```php
$wgStrictFileExtensions = false;
```

> **Disables strict file extension checking**. Allows uploads even if extension doesn't match MIME type.

```php
$wgCheckFileExtensions = false;
```

> **Turns off file extension validation entirely**. Use with caution — reduces security.

---

## User Account Creation

```php
$wgGroupPermissions['*']['createaccount'] = false;
```

> **Disables new account creation** for anonymous users (`*`). Users cannot register.

---

## Output Compression (Commented)

```php
## Uncomment this to disable output compression
# $wgDisableOutputCompression = true;
```

> **Optional**: Disable gzip compression if causing issues (e.g., with certain proxies).

---

## Site Identity

```php
$wgSitename = "My Test Wiki";
```

> **Name of the wiki**, appears in title bar, emails, etc.

```php
$wgMetaNamespace = "My_Test_Wiki";
```

> **Project namespace** (e.g., "My_Test_Wiki talk:" pages). Usually auto-generated from `$wgSitename`.

---

## URL Configuration

```php
$wgScriptPath = "/mediawiki";
```

> **Base path** where MediaWiki is installed (e.g., `http://example.com/mediawiki`).

```php
$wgServer = "http://172.18.29.119";
```

> **Full server URL** (protocol + domain/IP). Used to generate absolute links.

```php
$wgResourceBasePath = $wgScriptPath;
```

> **Path to static resources** (CSS, JS, images). Defaults to script path.

---

## Logo Settings

```php
$wgLogos = [
    '1x' => "http://172.18.29.119/mediawiki/images/9/96/Icon_hjv.png",
    'icon' => "http://172.18.29.119/mediawiki/images/9/96/Icon_hjv.png",
];
```

> **Custom logo** for the wiki.  
> - `'1x'`: Standard resolution  
> - `'icon'`: Favicon / mobile icon

> **Warning**: Must be updated on upgrade or it will be overwritten.

---

## Email Features

```php
$wgEnableEmail = true;
$wgEnableUserEmail = true; # UPO
```

> Enables outgoing email and user-to-user email feature.

```php
$wgEmergencyContact = "";
$wgPasswordSender = "";
```

> **Email addresses**:
> - `EmergencyContact`: Admin email for errors
> - `PasswordSender`: From address for password resets

```php
$wgEnotifUserTalk = false; # UPO
$wgEnotifWatchlist = false; # UPO
```

> Disables email notifications for talk page changes and watchlist updates.

```php
$wgEmailAuthentication = true;
```

> Requires email confirmation before using email features.

---

## Database Settings

```php
$wgDBtype = "mysql";
$wgDBserver = "localhost";
$wgDBname = "database";
$wgDBuser = "db_user";
$wgDBpassword = "P@ssw0rd";
```

> **MySQL connection details**.

```php
$wgDBprefix = "";
```

> Table prefix (empty = no prefix).

```php
$wgDBssl = false;
```

> Disable SSL for database connection.

```php
$wgDBTableOptions = "ENGINE=InnoDB, DEFAULT CHARSET=binary";
```

> MySQL table creation options: uses **InnoDB** and **binary charset** (case-sensitive).

```php
$wgSharedTables[] = "actor";
```

> Marks `actor` table as shared (used in shared DB setups).

---

## Caching & Performance

```php
$wgMainCacheType = CACHE_NONE;
```

> **Disables object caching**. Slower, but simpler for testing.

```php
$wgMemCachedServers = [];
```

> No Memcached servers configured.

---

## Image Processing (Commented)

```php
#$wgUseImageMagick = true;
#$wgImageMagickConvertCommand = "/usr/bin/convert";
```

> Would enable thumbnail generation using ImageMagick (if uncommented).

---

## Instant Commons

```php
$wgUseInstantCommons = false;
```

> Disables pulling images from Wikimedia Commons.

---

## Pingback (Telemetry)

```php
$wgPingback = true;
```

> Sends anonymous usage stats to MediaWiki.org to help development.

---

## Language & Timezone

```php
$wgLanguageCode = "en";
```

> Site language: English.

```php
$wgLocaltimezone = "UTC";
```

> Server timezone.

---

## Cache Directory (Commented)

```php
#$wgCacheDirectory = "$IP/cache";
```

> Would enable file-based caching if set and writable.

---

## Security Keys

```php
$wgSecretKey = "35e43818b8b3f04fce0178bfdec9845d9afe7d0936aa19d13bec7389e7a0ba56";
```

> Used for cookies, tokens, etc. **Keep secret!**

```php
$wgAuthenticationTokenVersion = "1";
```

> Invalidates all login sessions if changed.

```php
$wgUpgradeKey = "e26c4de60badf1f4";
```

> Required for web-based updater.

---

## Copyright / Licensing

```php
$wgRightsPage = ""; 
$wgRightsUrl = "";
$wgRightsText = "";
$wgRightsIcon = "";
```

> No custom copyright notice configured.

---

## External Tools

```php
$wgDiff3 = "/usr/bin/diff3";
```

> Path to `diff3` binary for edit conflict resolution.

---

## Default Skin

```php
$wgDefaultSkin = "timeless";
```

> Sets **Timeless** as default skin.

---

## Enabled Skins

```php
wfLoadSkin( 'MinervaNeue' );
wfLoadSkin( 'MonoBook' );
wfLoadSkin( 'Timeless' );
wfLoadSkin( 'Vector' );
```

> Loads additional skins:  
> - `MinervaNeue` – Mobile-friendly  
> - `MonoBook` – Classic  
> - `Timeless` – Modern, flexible  
> - `Vector` – Default desktop skin (legacy & 2022)

---

## Extensions

```php
wfLoadExtension( 'VisualEditor' );
```

> Enables **VisualEditor** (WYSIWYG editing).

---

## Permission Overrides (Personal Edits)

### Prevent Anonymous Editing

```php
$wgGroupPermissions['*']['edit'] = false;
```

> Anonymous users cannot edit.

```php
$wgGroupPermissions['*']['read'] = true;
```

> But they **can still read** pages.

```php
$wgGroupPermissions['user']['edit'] = true;
```

> Logged-in users can edit.

---

### FULL WIKI LOCKDOWN (Later Override)

```php
# --- Lock the entire wiki for non-logged-in users ---
$wgGroupPermissions['*']['read'] = false;
$wgGroupPermissions['*']['edit'] = false;

$wgGroupPermissions['user']['read'] = true;
$wgGroupPermissions['user']['edit'] = true;
```

> **Overrides earlier settings**  
> - Anonymous users **cannot read OR edit**  
> - Only **logged-in users** have full access

---

## Whitelist Pages for Anonymous Users

```php
$wgWhitelistRead = [
    'Special:UserLogin',
    'Special:UserLogout',
    'Special:PasswordReset'
];
```

> Allows anonymous users to **view specific special pages** even when read access is blocked.

```php
$wgWhitelistReadRegexp = [
    '/^Special:UserLogin/', 
    '/^Special:UserLogout/'
];
```

> Same as above, but using **regex patterns**.  
> Note: These may be redundant with the array version.

---

## Summary of Final Access Rules

| User Type       | Can Read? | Can Edit? | Can See Login Page? |
|----------------|-----------|-----------|---------------------|
| Anonymous (`*`)| ❌ No      | ❌ No      | ✅ Yes (whitelisted) |
| Logged-in (`user`)| ✅ Yes  | ✅ Yes  | ✅ Yes              |

> **Wiki is fully private** — login required to view or edit anything except login/logout.

---

## Best Practices & Warnings

| Setting | Risk / Note |
|-------|------------|
| `$wgCheckFileExtensions = false` | Security risk — allows disguised malicious files |
| `$wgDBpassword` in plain text | Never commit to Git! Use `.gitignore` |
| Hardcoded IP (`172.18.29.119`) | Not portable; use domain or environment vars |
| Duplicate permission settings | Later ones **override** earlier — clean up duplicates |

---

## Recommended Cleanup

Remove redundant/contradictory lines:

```php
// Remove these — overridden later
$wgGroupPermissions['*']['edit'] = false;
$wgGroupPermissions['*']['read'] = true;
$wgGroupPermissions['user']['edit'] = true;
```

#### Full config file:
```php
<?php
# This file was automatically generated by the MediaWiki 1.44.2
# installer. If you make manual changes, please keep track in case you
# need to recreate them later.
#
# See includes/MainConfigSchema.php for all configurable settings
# and their default values, but don't forget to make changes in _this_
# file, not there.
#
# Further documentation for configuration settings may be found at:
# https://www.mediawiki.org/wiki/Manual:Configuration_settings

# Protect against web entry
if ( !defined( 'MEDIAWIKI' ) ) {
        exit;
}

$wgEnableUploads = true;
$wgStrictFileExtensions = false;
$wgCheckFileExtensions = false;
$wgGroupPermissions['*']['createaccount'] = false;


## Uncomment this to disable output compression
# $wgDisableOutputCompression = true;

$wgSitename = "My Test Wiki";
$wgMetaNamespace = "My_Test_Wiki";

## The URL base path to the directory containing the wiki;
## defaults for all runtime URL paths are based off of this.
## For more information on customizing the URLs
## (like /w/index.php/Page_title to /wiki/Page_title) please see:
## https://www.mediawiki.org/wiki/Manual:Short_URL
$wgScriptPath = "/mediawiki";

## The protocol and server name to use in fully-qualified URLs
$wgServer = "http://172.18.29.119";

## The URL path to static resources (images, scripts, etc.)
$wgResourceBasePath = $wgScriptPath;

## The URL paths to the logo.  Make sure you change this from the default,
## or else you'll overwrite your logo when you upgrade!
$wgLogos = [
        '1x' => "http://172.18.29.119/mediawiki/images/9/96/Icon_hjv.png",
        'icon' => "http://172.18.29.119/mediawiki/images/9/96/Icon_hjv.png",
];

## UPO means: this is also a user preference option

$wgEnableEmail = true;
$wgEnableUserEmail = true; # UPO

$wgEmergencyContact = "";
$wgPasswordSender = "";

$wgEnotifUserTalk = false; # UPO
$wgEnotifWatchlist = false; # UPO
$wgEmailAuthentication = true;

## Database settings
$wgDBtype = "mysql";
$wgDBserver = "localhost";
$wgDBname = "database";
$wgDBuser = "db_user";
$wgDBpassword = "P@ssw0rd";

# MySQL specific settings
$wgDBprefix = "";
$wgDBssl = false;

# MySQL table options to use during installation or update
$wgDBTableOptions = "ENGINE=InnoDB, DEFAULT CHARSET=binary";

# Shared database table
# This has no effect unless $wgSharedDB is also set.
$wgSharedTables[] = "actor";

## Shared memory settings
$wgMainCacheType = CACHE_NONE;
$wgMemCachedServers = [];

## To enable image uploads, make sure the 'images' directory
## is writable, then set this to true:
#$wgUseImageMagick = true;
#$wgImageMagickConvertCommand = "/usr/bin/convert";

# InstantCommons allows wiki to use images from https://commons.wikimedia.org
$wgUseInstantCommons = false;

# Periodically send a pingback to https://www.mediawiki.org/ with basic data
# about this MediaWiki instance. The Wikimedia Foundation shares this data
# with MediaWiki developers to help guide future development efforts.
$wgPingback = true;

# Site language code, should be one of the list in ./includes/languages/data/Names.php
$wgLanguageCode = "en";

# Time zone
$wgLocaltimezone = "UTC";

## Set $wgCacheDirectory to a writable directory on the web server
## to make your wiki go slightly faster. The directory should not
## be publicly accessible from the web.
#$wgCacheDirectory = "$IP/cache";

$wgSecretKey = "35e43818b8b3f04fce0178bfdec9845d9afe7d0936aa19d13bec7389e7a0ba56";

# Changing this will log out all existing sessions.
$wgAuthenticationTokenVersion = "1";

# Site upgrade key. Must be set to a string (default provided) to turn on the
# web installer while LocalSettings.php is in place
$wgUpgradeKey = "e26c4de60badf1f4";

## For attaching licensing metadata to pages, and displaying an
## appropriate copyright notice / icon. GNU Free Documentation
## License and Creative Commons licenses are supported so far.
$wgRightsPage = ""; # Set to the title of a wiki page that describes your license/copyright
$wgRightsUrl = "";
$wgRightsText = "";
$wgRightsIcon = "";

# Path to the GNU diff3 utility. Used for conflict resolution.
$wgDiff3 = "/usr/bin/diff3";

## Default skin: you can change the default skin. Use the internal symbolic
## names, e.g. 'vector' or 'monobook':
$wgDefaultSkin = "timeless";

# Enabled skins.
# The following skins were automatically enabled:
wfLoadSkin( 'MinervaNeue' );
wfLoadSkin( 'MonoBook' );
wfLoadSkin( 'Timeless' );
wfLoadSkin( 'Vector' );


# End of automatically generated settings.
# Add more configuration options below.


# MY PERSONAL EDITS
wfLoadExtension( 'VisualEditor' );

# Prevent anonymous users from editing
$wgGroupPermissions['*']['edit'] = false;

# Optional: still allow them to view pages
$wgGroupPermissions['*']['read'] = true;

# Optional: allow only registered, confirmed users to edit
$wgGroupPermissions['user']['edit'] = true;

# This code lockes the page. Only Auth users can view and edit.
# --- Lock the entire wiki for non-logged-in users ---

# Disable reading for anonymous users
$wgGroupPermissions['*']['read'] = false;

# Disable editing for anonymous users
$wgGroupPermissions['*']['edit'] = false;

# Allow logged-in users to read and edit
$wgGroupPermissions['user']['read'] = true;
$wgGroupPermissions['user']['edit'] = true;

# Optional: still allow viewing of the login and main page (for example)
$wgWhitelistRead = [
    'Special:UserLogin',
    'Special:UserLogout',
    'Special:PasswordReset'
];

# Force redirect to login for unauthorized users
$wgWhitelistReadRegexp = [
    '/^Special:UserLogin/',  # allow login page
    '/^Special:UserLogout/'  # allow logout page
];
```

### Change Uplad Max filesize:
Goto /etc/php/8.3/apache2 and open php.ini
Change the following code to change the max file size opload
```ini
upload_max_filesize = 50M
post_max_size = 50M
max_execution_time = 300
```
